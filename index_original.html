<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>parallel coordinates</title>
	<!--<link href='http://fonts.googleapis.com/css?family=PT+Sans:400' rel='stylesheet' type='text/css'>-->
	<!--<link href="http://fonts.googleapis.com/css?family=Raleway:300,700" rel="stylesheet" type="text/css">-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="css/pc.css">
	<link rel="stylesheet" href="css/sm.css">
	<link rel="stylesheet" href="css/lc.css">

    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/foundation/js/foundation.js"></script>
    <script src="bower_components/modernizr/modernizr.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js" charset="utf-8"></script>
	<script>window.d3||document.write('<script src="js/vendors/d3/d3.min.js"><\/script>');</script>
</head>
<body>
	<div id="wrapper">
		<div id="header">
			<h1>Git<b>Hut</b></h1>
			<h2>Visualizing programming languages in GitHub</h2>
		</div>
		<div id="qc"></div>
		<div id="pc"></div>
		<div id="sm_header">
			<h2>Which languages are trending more?</h2>
			<h3>Trending programming languages in active GitHub repository</h3>
			<a href="#" id="num">#</a>
			&nbsp;&nbsp;
			<a href="#" id="perc">%</a>
		</div>
		<div id="sm"></div>
		<div id="footer"></div>
	</div>
	<script src="js/parallelcoordinates.js"></script>
	<script src="js/smallmultiples.js"></script>
	<script src="js/linechart.js"></script>
	<script>
	
		d3.csv("data/languages.csv",function(d){
			
			d["Year"]=+d["Year"];
			d["name_lc"]=d["Name"].toLowerCase();

			return d;
		
		},function(data){

			//console.log(data);

			var programming_languages={};
			data.forEach(function(lang){
				programming_languages[lang["name_lc"]]=lang["Year"];
			})

				var last_quarter="q2-2014";
				var unknonw=[];

				d3.csv("../server/exports/"+last_quarter+".csv",function(q){
					


					q.active_repos_by_url=+q.active_repos_by_url;
					q.events=+q.events;
					
					if(!programming_languages[q.repository_language.toLowerCase()]) {
						if(unknonw.indexOf(q.repository_language.toLowerCase())==-1) {
							unknonw.push(q.repository_language.toLowerCase())
						}
					}
					
					q.year=programming_languages[q.repository_language.toLowerCase()] || 1970;
                    console.log("q:")
					console.log(q)
					return q;
				},function(data){
                    console.log("data:");
					console.log(data);
					
					//console.log(unknonw)


					var events={};
					data.forEach(function(d){

						if(!events[d["repository_language"]]) {
							events[d["repository_language"]]={
								repository_language:d["repository_language"]
							};
						}
						switch(d["type"]) {
							case "CreateEvent":
								events[d["repository_language"]][d["type"]]=d["active_repos_by_url"];
							break;
							case "ForkEvent":
								events[d["repository_language"]][d["type"]]=d["events"]/d["active_repos_by_url"];
							break;
							case "PushEvent":
								events[d["repository_language"]][d["type"]+"Repo"]=d["active_repos_by_url"];
								events[d["repository_language"]][d["type"]+"All"]=d["events"];
								events[d["repository_language"]][d["type"]]=d["events"]/d["active_repos_by_url"];
							break;
							default:
								events[d["repository_language"]][d["type"]]=d["events"]/d["active_repos_by_url"];
							break;
						}
						
						events[d["repository_language"]].year=d.year;
						//events["active_repos_by_url"]=d["active_repos_by_url"];
					})
                    console.log("quantity:");
					console.log(d3.values(events));
					//return;
					pc=new ParallelCoordinates(d3.values(events),{
						//nested_by_quarter:nested_by_quarter,
						programming_languages:programming_languages,
						container:"#pc",
						scale:"linear",
						//columns:["name","created","active_repos_by_url","lang_usage","events_per_repo","sum_rep_size","sum_rep_forks","sum_rep_openissues","sum_rep_watchers","year"],
						columns:["name","PushEventRepo","PushEventAll","PushEvent","ForkEvent","IssuesEvent","WatchEvent","year"],//"CreateEvent"
						ref:"lang_usage",
						title_column:"name",
						scale_map:{
							"year":"linear",
							"name":"ordinal",
							"name2":"ordinal",
							"created":"ordinal",
							"CreateEvent":"ordinal",
							"PushEvent":"ordinal",
							"PushEventAll":"ordinal",
							"PushEventRepo":"ordinal",
							"active_repos_by_url":"ordinal",
							"events_per_repo":"ordinal",
							"lang_usage":"ordinal",
							"sum_rep_size":"ordinal",
							"ForkEvent":"ordinal",
							"IssuesEvent":"ordinal",
							"WatchEvent":"ordinal"
						},
						use:{
							"name":"PushEventRepo"
						},
						sorting:{
							"name":d3.descending
						},
						formats:{
							"year":"d"
						},
						dimensions:["created","CreateEvent","PushEventRepo","PushEventAll","PushEvent","ForkEvent","IssuesEvent","WatchEvent","active_repos_by_url","lang_usage","events_per_repo","year","name"],
						column_map:{
							"name":["Repository","Language"],
							"active_repos_by_url":"Active",
							"created":"Created",
							"CreateEvent":"New Repositories",
							"PushEvent":["Pushes","per Repository"],
							"PushEventAll":["Total","Pushes"],
							"PushEventRepo":["Active","Repositories"],
							"lang_usage":"Events",
							"year":["Appeared","in Year"],
							"events_per_repo":"Events/Repo",
							"sum_rep_size":"Repo Size",
							"ForkEvent":["New Forks","per Repository"],
							"IssuesEvent":["Opened Issues","per Repository"],
							"WatchEvent":["New Watchers","per Repository"]
						},
						duration:1000,
						path:"../server/exports/",
						extension:"csv"
					});

					d3.select("#load")
						.selectAll("a.load")
						.data([
							"q2-2012",
							"q3-2012",
							"q4-2012",
							"q1-2013",
							"q2-2013",
							"q3-2013",
							"q4-2013",
							"q1-2014",
							"q2-2014"
						])
						.enter()
						.append("a")
						.text(function(d){
							return d;
						})
						.attr("href","#")
						.style({
							margin:"0px 5px"
						})
						.on("click",function(d){
							d3.event.preventDefault();
							pc.loadData(d);
						})

		
				});

			

			
		});
		
	
	</script>
	
</body>
</html>